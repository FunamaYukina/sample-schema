// Prisma Schema with Enum Types Sample

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql" // Can be changed to mysql, sqlite, sqlserver, mongodb, cockroachdb
  url      = env("DATABASE_URL")
}

// Define Enums
enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  PENDING_VERIFICATION
  DELETED
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum PaymentMethod {
  CREDIT_CARD
  DEBIT_CARD
  PAYPAL
  BANK_TRANSFER
  CASH_ON_DELIVERY
  CRYPTOCURRENCY
}

enum PriorityLevel {
  LOW
  MEDIUM
  HIGH
  URGENT
  CRITICAL
}

enum NotificationType {
  EMAIL
  SMS
  PUSH
  IN_APP
  WEBHOOK
}

enum Weekday {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

enum TicketSeverity {
  TRIVIAL
  MINOR
  MAJOR
  CRITICAL
  BLOCKER
}

enum ProductCategory {
  ELECTRONICS
  CLOTHING
  BOOKS
  FOOD
  HOME_GARDEN
  SPORTS
  TOYS
  HEALTH_BEAUTY
}

// Role enum for user permissions
enum Role {
  USER
  MODERATOR
  ADMIN
  SUPER_ADMIN
}

// Define Models

model User {
  id                       String                    @id @default(cuid())
  email                    String                    @unique
  username                 String                    @unique
  password                 String?
  status                   UserStatus                @default(PENDING_VERIFICATION)
  role                     Role                      @default(USER)
  profile                  Profile?
  orders                   Order[]
  supportTickets           SupportTicket[]
  notificationPreferences  NotificationPreference?
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime                  @updatedAt
  
  @@index([status])
  @@index([role])
}

model Profile {
  id          String   @id @default(cuid())
  userId      String   @unique
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  firstName   String?
  lastName    String?
  bio         String?
  avatarUrl   String?
  phoneNumber String?
  birthDate   DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Product {
  id            String          @id @default(cuid())
  name          String
  description   String?
  price         Decimal         @db.Decimal(10, 2)
  category      ProductCategory
  stockQuantity Int             @default(0)
  sku           String          @unique
  isActive      Boolean         @default(true)
  orderItems    OrderItem[]
  reviews       Review[]
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  
  @@index([category])
  @@index([isActive])
}

model Order {
  id              String        @id @default(cuid())
  userId          String
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  status          OrderStatus   @default(PENDING)
  paymentMethod   PaymentMethod
  totalAmount     Decimal       @db.Decimal(10, 2)
  shippingAddress String?       @db.Text
  orderNumber     String        @unique @default(uuid())
  orderItems      OrderItem[]
  payment         Payment?
  shipment        Shipment?
  orderDate       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  @@index([status])
  @@index([userId])
}

model OrderItem {
  id         String  @id @default(cuid())
  orderId    String
  order      Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  productId  String
  product    Product @relation(fields: [productId], references: [id])
  quantity   Int
  unitPrice  Decimal @db.Decimal(10, 2)
  subtotal   Decimal @db.Decimal(10, 2)
  
  @@unique([orderId, productId])
}

model Payment {
  id              String        @id @default(cuid())
  orderId         String        @unique
  order           Order         @relation(fields: [orderId], references: [id], onDelete: Cascade)
  amount          Decimal       @db.Decimal(10, 2)
  paymentMethod   PaymentMethod
  transactionId   String?       @unique
  status          String        // Could be another enum: PENDING, COMPLETED, FAILED, REFUNDED
  processedAt     DateTime?
  createdAt       DateTime      @default(now())
}

model Shipment {
  id              String   @id @default(cuid())
  orderId         String   @unique
  order           Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  trackingNumber  String?  @unique
  carrier         String?
  shippedDate     DateTime?
  deliveredDate   DateTime?
  estimatedDelivery DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model SupportTicket {
  id          String         @id @default(cuid())
  userId      String
  user        User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  title       String
  description String         @db.Text
  priority    PriorityLevel  @default(MEDIUM)
  severity    TicketSeverity @default(MINOR)
  assignedTo  String?
  resolvedAt  DateTime?
  ticketNumber String        @unique @default(uuid())
  comments    Comment[]
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  
  @@index([priority])
  @@index([severity])
}

model Comment {
  id        String        @id @default(cuid())
  ticketId  String
  ticket    SupportTicket @relation(fields: [ticketId], references: [id], onDelete: Cascade)
  content   String        @db.Text
  authorId  String
  isInternal Boolean      @default(false)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
}

model NotificationPreference {
  id              String             @id @default(cuid())
  userId          String             @unique
  user            User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  enabledTypes    NotificationType[] // Array of enum values
  quietHoursStart DateTime?          @db.Time()
  quietHoursEnd   DateTime?          @db.Time()
  quietDays       Weekday[]          // Array of enum values
  emailFrequency  String?            // Could be another enum: INSTANT, DAILY, WEEKLY
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
}

model Review {
  id        String   @id @default(cuid())
  productId String
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  userId    String
  rating    Int      // 1-5 stars
  title     String?
  comment   String?  @db.Text
  isVerified Boolean @default(false)
  helpful   Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([productId])
  @@index([rating])
  @@unique([productId, userId])
}

// Example of a model with composite enum usage
model AuditLog {
  id          String   @id @default(cuid())
  entityType  String   // e.g., "User", "Order", "Product"
  entityId    String
  action      String   // e.g., "CREATE", "UPDATE", "DELETE"
  userId      String?
  changes     Json?    // Store the changes as JSON
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime @default(now())
  
  @@index([entityType, entityId])
  @@index([userId])
}

// Sample models demonstrating various @default functions
model SampleAutoIncrement {
  id          Int      @id @default(autoincrement())
  name        String
  createdAt   DateTime @default(now())
}

model SampleUUID {
  id          String   @id @default(uuid())
  uuid4Field  String   @default(uuid(4))
  uuid7Field  String   @default(uuid(7))
  name        String
  createdAt   DateTime @default(now())
}

model SampleCUID {
  id          String   @id @default(cuid())
  cuid2Field  String   @default(cuid(2))
  name        String
  createdAt   DateTime @default(now())
}

model SampleULID {
  id          String   @id @default(ulid())
  name        String
  createdAt   DateTime @default(now())
}

model SampleNanoID {
  id          String   @id @default(nanoid())
  size7       String   @default(nanoid(7))
  size10      String   @default(nanoid(10))
  name        String
  createdAt   DateTime @default(now())
}

model SampleDBGenerated {
  id          String   @id @default(dbgenerated("gen_random_uuid()"))
  timestamp   DateTime @default(dbgenerated("CURRENT_TIMESTAMP"))
  randomNum   Float    @default(dbgenerated("random()"))
  name        String
}

model SampleTimestamps {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  deletedAt   DateTime?
}

model SampleMixed {
  id          String   @id @default(uuid(7))
  autoNum     Int      @default(autoincrement()) @unique
  cuidCode    String   @default(cuid())
  cuid2Code   String   @default(cuid(2))
  nanoCode    String   @default(nanoid(12))
  ulidCode    String   @default(ulid())
  timestamp   DateTime @default(now())
  customSeq   Int      @default(autoincrement())
  name        String
  isActive    Boolean  @default(true)
  score       Float    @default(0.0)
  
  @@index([autoNum])
  @@index([timestamp])
}