# Prisma @default Functions - Database Compatibility Matrix

## Default Functions Overview

| Function | Description | PostgreSQL | MySQL | SQLite | SQL Server | MongoDB | CockroachDB |
|----------|-------------|------------|--------|---------|------------|----------|-------------|
| **`autoincrement()`** | Sequential integer IDs | ✅ SERIAL/IDENTITY | ✅ AUTO_INCREMENT | ✅ AUTOINCREMENT | ✅ IDENTITY | ❌ | ✅ SERIAL |
| **`sequence()`** | Custom sequence | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ SERIAL |
| **`dbgenerated(...)`** | Database-specific expression | ✅ | ✅ | ✅ | ✅ | ❌ | ✅ |
| **`cuid()`** | Collision-resistant unique ID (v1) | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| **`cuid(2)`** | CUID version 2 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| **`uuid()`** | UUID v4 (default) | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| **`uuid(4)`** | UUID version 4 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| **`uuid(7)`** | UUID version 7 (time-ordered) | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| **`ulid()`** | Universally Unique Lexicographically Sortable ID | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| **`nanoid()`** | Nano ID (default size: 21) | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| **`nanoid(size)`** | Nano ID with custom size | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| **`now()`** | Current timestamp | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| **`auto()`** | Auto-generated MongoDB ObjectId | ❌ | ❌ | ❌ | ❌ | ✅ ObjectId | ❌ |

## Detailed Migration Mappings (Prisma Migrate Results)

| Prisma Function | PostgreSQL Type | PostgreSQL DEFAULT | Description |
|-----------------|-----------------|-------------------|-------------|
| **`autoincrement()`** | `SERIAL` | None (implicit sequence) | Sequential integer generation. SERIAL type handles auto-increment internally |
| **`sequence()`** | ❌ Not Supported | ❌ Not Supported | **CockroachDB only** - Custom sequence generation via Prisma |
| **`dbgenerated(...)`** | Depends on expression | Custom SQL expression | **SQL databases only** - Only function that creates actual DEFAULT values |
| **`auto()`** | ❌ Not Supported | ❌ Not Supported | **MongoDB only** - Generates ObjectId automatically |
| **`cuid()`** | `TEXT` | None (Prisma Client) | Generated at runtime by Prisma Client. Universal support |
| **`cuid(2)`** | `TEXT` | None (Prisma Client) | **Requires Prisma 6.0.0+** - CUID v2 for improved security. Generated at runtime by Prisma Client |
| **`uuid()`** | `TEXT` | None (Prisma Client) | Generated at runtime by Prisma Client, not by database |
| **`uuid(4)`** | `TEXT` | None (Prisma Client) | Generated at runtime by Prisma Client, not by database |
| **`uuid(7)`** | `TEXT` | None (Prisma Client) | Time-ordered UUID v7. Generated at runtime by Prisma Client |
| **`ulid()`** | `TEXT` | None (Prisma Client) | **Supported in Prisma 6.14.0+** - Lexicographically sortable unique ID. Generated at runtime by Prisma Client |
| **`nanoid()`** | `TEXT` | None (Prisma Client) | Nano ID with default 21 characters. Generated at runtime by Prisma Client |
| **`nanoid(size)`** | `TEXT` | None (Prisma Client) | Nano ID with custom size. Generated at runtime by Prisma Client |
| **`now()`** | `TIMESTAMP(3)` | `CURRENT_TIMESTAMP` | Database-level DEFAULT value. Universal support |

### Migration Examples from Actual Results

| Example Field | Prisma Schema | PostgreSQL Result |
|---------------|---------------|-------------------|
| `User.id` | `String @id @default(cuid())` | `"id" TEXT NOT NULL` |
| `Order.orderNumber` | `String @unique @default(uuid())` | `"orderNumber" TEXT NOT NULL` |
| `SampleAutoIncrement.id` | `Int @id @default(autoincrement())` | `"id" SERIAL NOT NULL` |
| `SampleDBGenerated.id` | `String @id @default(dbgenerated("gen_random_uuid()"))` | `"id" TEXT NOT NULL DEFAULT gen_random_uuid()` |
| `User.createdAt` | `DateTime @default(now())` | `"createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP` |
| `User.updatedAt` | `DateTime @updatedAt` | `"updatedAt" TIMESTAMP(3) NOT NULL` |
| `SampleMixed.id` | `String @id @default(uuid(7))` | `"id" TEXT NOT NULL` |
| `SampleCUID.cuid2Field` | `String @default(cuid(2))` | `"cuid2Field" TEXT NOT NULL` |
| `SampleULID.id` | `String @id @default(ulid())` | `"id" TEXT NOT NULL` |
| `SampleNanoID.size7` | `String @default(nanoid(7))` | `"size7" TEXT NOT NULL` |

### Notes:
- **`SERIAL`**: PostgreSQL's SERIAL type automatically creates a sequence and uses `nextval()` internally, but no explicit DEFAULT clause appears in the migration
- **"None (Prisma Client)"**: Generated by Prisma client at application level, not by database
- **"None (implicit sequence)"**: SERIAL type handles auto-increment without explicit DEFAULT clause
- **Version Dependencies**: 
  - `cuid(2)` requires Prisma 6.0.0+ (Nov 28, 2024)
  - `ulid()` supported in Prisma 6.14.0+
  - Current project upgraded from v5.22.0 to v6.14.0 successfully
- **MySQL**: `UUID()` function requires MySQL 8.0 or higher
- **PostgreSQL**: `gen_random_uuid()` requires `pgcrypto` extension or PostgreSQL 13+
- **MongoDB**: Uses Binary subtype 4 for UUID storage
- **SQLite**: Most ID generation happens at application layer due to limited built-in functions

## Database-Specific Limitations

### PostgreSQL
- ✅ Full support for all functions except `auto()` and `sequence()`
- Native UUID support with extensions
- Custom sequences available via `dbgenerated()`

### MySQL
- ✅ Most functions supported
- UUID support requires MySQL 8.0+
- No native sequence support
- `AUTO_INCREMENT` limited to one per table

### SQLite
- ⚠️ Limited native function support
- Most IDs generated at application layer
- No native UUID generation
- Simple but limited

### SQL Server
- ✅ Good support for most functions
- `IDENTITY` instead of sequences
- Native UUID via `NEWID()`
- No `auto()` or `sequence()` support

### MongoDB
- ✅ `auto()` for ObjectId - **MongoDB exclusive**
- ❌ No `autoincrement()` - counter pattern required
- ❌ No `sequence()` support
- ❌ No `dbgenerated()` - schema-less
- All other IDs generated at application layer

### CockroachDB
- ✅ `sequence()` - **CockroachDB exclusive** (via Prisma)
- ✅ Excellent distributed ID support
- Native UUID generation
- SERIAL type for sequences
- Full SQL compatibility

## Best Practices by Database

| Database | Recommended ID Strategy | Reason |
|----------|------------------------|---------|
| **PostgreSQL** | `uuid()` or `cuid()` | Better for distributed systems |
| **MySQL** | `autoincrement()` or `uuid()` | Depends on MySQL version |
| **SQLite** | `autoincrement()` or `cuid()` | Simple incrementing or app-generated |
| **SQL Server** | `autoincrement()` or `uuid()` | IDENTITY is optimized |
| **MongoDB** | `auto()` | Native ObjectId is standard |
| **CockroachDB** | `uuid(7)` or `sequence()` | Time-ordered or sequential for distribution |

## Function Availability Summary

### Universal Functions (All Databases)
- `cuid()`, `cuid(2)`
- `uuid()`, `uuid(4)`, `uuid(7)`
- `ulid()`
- `nanoid()`, `nanoid(size)`
- `now()`

### Restricted Functions
- `autoincrement()` - Not in MongoDB
- `sequence()` - CockroachDB only
- `auto()` - MongoDB only
- `dbgenerated()` - SQL databases only

## Migration Considerations

1. **From SQL to MongoDB**: Replace `autoincrement()` with `auto()`
2. **From MongoDB to SQL**: Replace `auto()` with `uuid()` or `cuid()`
3. **To CockroachDB**: Can use `sequence()` for better performance
4. **Cross-platform**: Use `uuid()`, `cuid()`, or `ulid()` for portability